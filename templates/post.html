 {% extends "base.html" %}

{% block content %}
    <a href="{{ url_for('index', channel=post.channel) }}" class="btn btn-secondary btn-sm mb-3">← Back to {{ post.channel.replace('_', ' ').title() }} Channel</a>
    <div class="card mb-4">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <h5 class="card-title">{{ post.body }}</h5>
                    <p class="card-text"><small class="text-muted">
                        Posted by {{ post.author.username }} in <span class="badge badge-primary">{{ post.channel.replace('_', ' ').title() }}</span> on {{ post.timestamp.strftime('%Y-%m-%d %H:%M') }}
                    </small></p>
                </div>
                <div class="text-center">
                    <a href="{{ url_for('upvote', post_id=post.id) }}" class="btn btn-sm {% if user_vote and user_vote.value == 1 %}btn-success{% else %}btn-outline-success{% endif %}">▲</a>
                    <br>
                    <strong>{{ post.total_votes() }}</strong>
                    <br>
                    <a href="{{ url_for('downvote', post_id=post.id) }}" class="btn btn-sm {% if user_vote and user_vote.value == -1 %}btn-danger{% else %}btn-outline-danger{% endif %}">▼</a>
                </div>
            </div>
        </div>
    </div>

    <h4 class="mt-4">Comments ({{ post.comments.count() }})</h4>
    {% for comment in comments %}
        <div class="card mb-2">
            <div class="card-body py-2">
                <p class="card-text">{{ comment.body }}</p>
                <small class="text-muted">Comment by {{ comment.author.username }} on {{ comment.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>
            </div>
        </div>
    {% else %}
        <p>No comments yet. Be the first to comment!</p>
    {% endfor %}

    <h5 class="mt-4">Add a Comment</h5>
    <form action="{{ url_for('view_post', post_id=post.id) }}" method="post" novalidate>
        {{ form.hidden_tag() }}
        <div class="form-group">
            {{ form.body.label(class="form-label") }}
            {{ form.body(class="form-control", rows=2, placeholder="Your insightful comment...") }}
            {% for error in form.body.errors %}
                <span class="text-danger">[{{ error }}]</span>
            {% endfor %}
        </div>
        {{ form.submit(class="btn btn-primary") }}
    </form>
{% endblock %}
